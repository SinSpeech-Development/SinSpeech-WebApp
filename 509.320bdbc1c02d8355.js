"use strict";(self.webpackChunksinspeech_demo_app=self.webpackChunksinspeech_demo_app||[]).push([[509],{1509:(le,pe,j)=>{j.r(pe),j.d(pe,{HomeModule:()=>re});var V=j(9808),S=j(2783),be=j(5108),t=j(1223),he=j(4004),Le=j(520);let J=(()=>{class x{constructor(C){this.http=C,this.serverUrl="http://143.198.76.162:5000"}upload(C){return this.http.post(`${this.serverUrl}/offline-decode`,C,{observe:"body",responseType:"json"}).pipe((0,he.U)(U=>U.result))}}return x.\u0275fac=function(C){return new(C||x)(t.LFG(Le.eN))},x.\u0275prov=t.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();var we=j(2313);function ee(x,L){if(1&x){const C=t.EpF();t.TgZ(0,"div",6),t.TgZ(1,"div",7),t.NdJ("click",function(){return t.CHM(C),t.oxw().recordButtonClicked()}),t.TgZ(2,"div",8),t._UZ(3,"img",9),t.TgZ(4,"h2",10),t._uU(5,"RECORD ONLINE"),t.qZA(),t.qZA(),t.TgZ(6,"div"),t.TgZ(7,"P",11),t._uU(8,"Please allow your browser to access microphone"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"p",12),t._uU(10,"or"),t.qZA(),t.TgZ(11,"label",13),t.TgZ(12,"div",14),t._UZ(13,"img",15),t.TgZ(14,"h2",16),t._uU(15,"UPLOAD AUDIO FILE"),t.qZA(),t.qZA(),t.TgZ(16,"div"),t.TgZ(17,"P",17),t._uU(18,"Supported formats: MP3, WAV, FLAC, M4A"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"input",18),t.NdJ("change",function(F){return t.CHM(C),t.oxw().onUploadFiles(F.target.files)}),t.qZA(),t.TgZ(20,"div",19),t.TgZ(21,"p",20),t._uU(22,"To obtain better accurate results, we recommend the following regarding your input audio:"),t.qZA(),t.TgZ(23,"p",21),t._uU(24,"Limit the duration to 10 seconds (i.e. a single sentence)"),t.qZA(),t.TgZ(25,"p",21),t._uU(26,"Avoid background noise as much as possible"),t.qZA(),t.qZA(),t.qZA()}}function ae(x,L){1&x&&(t.TgZ(0,"span"),t._uU(1,"Uploaded file: "),t.qZA())}function B(x,L){1&x&&(t.TgZ(0,"span"),t._uU(1,"Recorded uploaded file: "),t.qZA())}function me(x,L){1&x&&(t.TgZ(0,"div",34),t._uU(1," Processing... "),t.qZA())}function ue(x,L){if(1&x){const C=t.EpF();t.TgZ(0,"div",35),t.TgZ(1,"div",36),t._uU(2,"Decoded text:"),t.qZA(),t.TgZ(3,"div",37),t._uU(4),t.qZA(),t.TgZ(5,"div",38),t.NdJ("click",function(){return t.CHM(C),t.oxw(2).copyDecodedText()}),t._uU(6," Copy to clipboard "),t.qZA(),t.qZA()}if(2&x){const C=t.oxw(2);t.xp6(4),t.hij(" ",C.decodedText," ")}}function ye(x,L){1&x&&(t.TgZ(0,"div",39),t._uU(1," Error occured while decoding "),t.qZA())}function Y(x,L){if(1&x){const C=t.EpF();t.TgZ(0,"div",22),t.TgZ(1,"div",23),t.TgZ(2,"div",24),t.YNc(3,ae,2,0,"span",25),t.YNc(4,B,2,0,"span",25),t._uU(5),t.qZA(),t._UZ(6,"audio",26),t.qZA(),t.YNc(7,me,2,0,"div",27),t.YNc(8,ue,7,1,"div",28),t.YNc(9,ye,2,0,"div",29),t.TgZ(10,"div",30),t.NdJ("click",function(){return t.CHM(C),t.oxw().goToHomePage()}),t.TgZ(11,"div",31),t._UZ(12,"img",32),t.TgZ(13,"h2",33),t._uU(14,"HOME"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&x){const C=t.oxw();t.xp6(3),t.Q6J("ngIf","notRecording"==C.recordingStatus),t.xp6(1),t.Q6J("ngIf","recordingStopped"==C.recordingStatus),t.xp6(1),t.hij(" ",C.selectedFile," "),t.xp6(1),t.Q6J("src",C.urlObj,t.LSH),t.xp6(1),t.Q6J("ngIf","processing"==C.uploadStatus),t.xp6(1),t.Q6J("ngIf","finished"==C.uploadStatus),t.xp6(1),t.Q6J("ngIf","error"==C.uploadStatus)}}function ce(x,L){1&x&&(t.TgZ(0,"p",43),t._uU(1,"Recording..."),t.qZA())}function H(x,L){1&x&&(t.TgZ(0,"p",39),t._uU(1,"Error occured while recording"),t.qZA())}function ge(x,L){if(1&x){const C=t.EpF();t.TgZ(0,"div",44),t.TgZ(1,"img",45),t.NdJ("click",function(){return t.CHM(C),t.oxw(2).startRecording()}),t.qZA(),t.TgZ(2,"h2",46),t._uU(3,"Start recording"),t.qZA(),t.qZA()}}function Re(x,L){if(1&x){const C=t.EpF();t.TgZ(0,"div",44),t.TgZ(1,"img",47),t.NdJ("click",function(){return t.CHM(C),t.oxw(2).stopRecording()}),t.qZA(),t.TgZ(2,"h2",46),t._uU(3,"Stop recording"),t.qZA(),t.qZA()}}function xe(x,L){if(1&x&&(t.TgZ(0,"div",40),t.YNc(1,ce,2,0,"p",41),t.YNc(2,H,2,0,"p",29),t.TgZ(3,"div",19),t.TgZ(4,"p",20),t._uU(5,"Make sure to..."),t.qZA(),t.TgZ(6,"p",21),t._uU(7,"start speaking after clicking the button (wait about 1 second before you speak) and,"),t.qZA(),t.TgZ(8,"p",21),t._uU(9,"stop recording after you completely finish speaking (wait about 1 second before you click the button)"),t.qZA(),t.qZA(),t.YNc(10,ge,4,0,"div",42),t.YNc(11,Re,4,0,"div",42),t.qZA()),2&x){const C=t.oxw();t.xp6(1),t.Q6J("ngIf","recordingStarted"==C.recordingStatus),t.xp6(1),t.Q6J("ngIf","recordingError"==C.recordingStatus),t.xp6(8),t.Q6J("ngIf","notRecording"==C.recordingStatus),t.xp6(1),t.Q6J("ngIf","recordingStarted"==C.recordingStatus)}}const Ce=[{path:"",component:(()=>{class x{constructor(C,U){this.fileService=C,this.sanitization=U,this.uiState="home",this.selectedFile="",this.uploadStatus="",this.decodedText="",this.recordingStatus="notRecording"}ngOnInit(){}recordButtonClicked(){this.uiState="record",this.recordingStatus="notRecording"}startRecording(){navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(this.successCallback.bind(this),this.errorCallback.bind(this))}successCallback(C){this.stream=C,this.recordingStatus="recordingStarted",this.recorder=new(0,be.StereoAudioRecorder)(C,{type:"audio",mimeType:"audio/flac",numberOfAudioChannels:1,sampleRate:C.sampleRate}),this.recorder.record()}errorCallback(C){this.recordingStatus="recordingError"}stopRecording(){this.recordingStatus="recordingStopped",this.recorder.stop(this.processRecording.bind(this)),this.stream.getTracks().forEach(function(C){C.stop()})}processRecording(C){this.recordedFile=new File([C],"recording.flac"),this.onUploadFiles([this.recordedFile])}onUploadFiles(C){const U=new FormData;for(const F of C)this.urlObj=this.sanitization.bypassSecurityTrustResourceUrl(URL.createObjectURL(F)),this.selectedFile=F.name,U.append("file",F,F.name);this.uploadStatus="processing",this.fileService.upload(U).subscribe({next:F=>{this.uploadStatus="finished",this.decodedText=F},error:()=>{this.uploadStatus="error",this.decodedText=""}}),this.uiState="upload"}copyDecodedText(){navigator.clipboard.writeText(this.decodedText)}goToHomePage(){window.location.reload()}}return x.\u0275fac=function(C){return new(C||x)(t.Y36(J),t.Y36(we.H7))},x.\u0275cmp=t.Xpm({type:x,selectors:[["app-home"]],decls:7,vars:3,consts:[[1,"outer-container"],["src","assets/sinspeech_logo.png",1,"logo"],[1,"title"],["class","home-container",4,"ngIf"],["class","upload-container",4,"ngIf"],["class","record-container",4,"ngIf"],[1,"home-container"],[1,"record","btn","btn-info",3,"click"],[1,"record-inner-container"],["src","assets/microphone_icon.png",1,"icon"],[1,"record-label"],[1,"record-description"],[1,"or"],["for","file",1,"upload","btn","btn-info"],[1,"upload-inner-container"],["src","assets/upload_icon.png",1,"icon"],[1,"upload-label"],[1,"upload-description"],["hidden","","id","file","type","file","name","files","single","","accept",".flac, .mp3, .wav",3,"change"],[1,"instructions-container"],[1,"instruction-title"],[1,"instruction"],[1,"upload-container"],[1,"uploaded-file"],[1,"uploaded-file-text"],[4,"ngIf"],["controls","",3,"src"],["class","processing",4,"ngIf"],["class","decode",4,"ngIf"],["class","error",4,"ngIf"],[1,"home-button","btn","btn-info",3,"click"],[1,"home-button-inner-container"],["src","assets/home_icon.png",1,"icon"],[1,"home-label"],[1,"processing"],[1,"decode"],[1,"decoded-text-label"],[1,"decoded-text"],[1,"copy-button","btn","btn-info",3,"click"],[1,"error"],[1,"record-container"],["class","recording",4,"ngIf"],["class","start-stop-record",4,"ngIf"],[1,"recording"],[1,"start-stop-record"],["src","assets/start_record_icon.png",1,"record-icon",3,"click"],[1,"recording-label"],["src","assets/stop_record_icon.png",1,"record-icon",3,"click"]],template:function(C,U){1&C&&(t.TgZ(0,"div",0),t._UZ(1,"img",1),t.TgZ(2,"h2",2),t._uU(3,"Open-source Sinhala Speech Recognition"),t.qZA(),t.YNc(4,ee,27,0,"div",3),t.YNc(5,Y,15,7,"div",4),t.YNc(6,xe,12,4,"div",5),t.qZA()),2&C&&(t.xp6(4),t.Q6J("ngIf","home"==U.uiState),t.xp6(1),t.Q6J("ngIf","upload"==U.uiState),t.xp6(1),t.Q6J("ngIf","record"==U.uiState))},directives:[V.O5],styles:['.outer-container[_ngcontent-%COMP%]{min-width:940px;display:flex;flex-direction:column;padding:10px;justify-content:center;align-items:center}.logo[_ngcontent-%COMP%]{width:160px;height:160px}.title[_ngcontent-%COMP%]{font-family:Garamond,"serif";font-size:50px;font-weight:500;padding-top:20px}.home-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.record[_ngcontent-%COMP%]{width:400px;height:75px;margin-top:20px;margin-bottom:10px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#b4edca;border-color:#b4edca;border-radius:18pt}.record-inner-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:5px}.record-label[_ngcontent-%COMP%]{font-weight:500;font-family:Garamond,"serif";font-size:30px;margin:0}.record-description[_ngcontent-%COMP%]{margin:0;font-size:13px}.icon[_ngcontent-%COMP%]{width:25px;height:25px}.or[_ngcontent-%COMP%]{margin:0;font-size:20px}.upload[_ngcontent-%COMP%]{width:400px;height:75px;margin-top:10px;margin-bottom:20px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#b4edca;border-color:#b4edca;border-radius:18pt}.upload-inner-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:5px}.upload-label[_ngcontent-%COMP%]{font-weight:500;font-family:Garamond,"serif";font-size:30px;margin:0}.upload-description[_ngcontent-%COMP%]{margin:0;font-size:13px}.instructions-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#f4feff;padding:10px}.instruction-title[_ngcontent-%COMP%]{margin:0;font-size:16px}.instruction[_ngcontent-%COMP%]{margin:0;font-size:13px}.upload-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.uploaded-file[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px;display:flex;flex-direction:column;justify-content:center;align-items:center}.uploaded-file-text[_ngcontent-%COMP%]{margin-bottom:10px;font-family:Garamond,"serif";font-size:20px;font-weight:500}audio[_ngcontent-%COMP%]{background-color:#b4edca;padding:5px;border-radius:18pt}.processing[_ngcontent-%COMP%]{padding-bottom:20px}.decode[_ngcontent-%COMP%]{padding-bottom:20px;display:flex;flex-direction:column;justify-content:center;align-items:center}.decoded-text-label[_ngcontent-%COMP%]{margin-bottom:10px;font-family:Garamond,"serif";font-size:20px;font-weight:500}.decoded-text[_ngcontent-%COMP%]{margin-bottom:10px;min-height:100px;padding:20px;width:799px;border:2px solid #a6b6c2;border-radius:10px}.copy-button[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#c4ccd7;border:2px solid #a6b6c2;border-radius:10px}.error[_ngcontent-%COMP%]{color:#f0868b;padding-bottom:20px}.home-button[_ngcontent-%COMP%]{background-color:#f7f7f7;border:2px solid black;border-radius:10px}.home-button-inner-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:5px}.home-label[_ngcontent-%COMP%]{font-weight:500;font-family:Garamond,"serif";font-size:30px;margin:0}.record-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px}.recording[_ngcontent-%COMP%]{padding-bottom:5px}.start-stop-record[_ngcontent-%COMP%]{margin-top:30px;display:flex;flex-direction:column;align-items:center}.record-icon[_ngcontent-%COMP%]{width:75px;height:75px;cursor:pointer}.recording-label[_ngcontent-%COMP%]{font-weight:500;font-family:Garamond,"serif";font-size:20px;margin:0}']}),x})()}];let _e=(()=>{class x{}return x.\u0275fac=function(C){return new(C||x)},x.\u0275mod=t.oAB({type:x}),x.\u0275inj=t.cJS({imports:[[S.Bz.forChild(Ce)],S.Bz]}),x})(),re=(()=>{class x{}return x.\u0275fac=function(C){return new(C||x)},x.\u0275mod=t.oAB({type:x}),x.\u0275inj=t.cJS({imports:[[V.ez,_e]]}),x})()},5108:(le,pe)=>{var V,r;function S(r,e){if(!r)throw"First parameter is required.";e=new be(r,e=e||{type:"video"});var i=this;function u(h){h&&(e.initCallback=function(){h(),h=e.initCallback=null});var c=new t(r,e);(f=new c(r,e)).record(),w("recording"),e.disableLogs||console.log("Initialized recorderType:",f.constructor.name,"for output-type:",e.type)}function o(h){if(h=h||function(){},f){if("paused"===i.state)return i.resumeRecording(),void setTimeout(function(){o(h)},1);"recording"!==i.state&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',i.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),"gif"!==e.type?f.stop(c):(f.stop(),c()),w("stopped")}else g();function c(v){if(f){Object.keys(f).forEach(function(y){"function"!=typeof f[y]&&(i[y]=f[y])});var a=f.blob;if(!a){if(!v)throw"Recording failed.";f.blob=a=v}if(a&&!e.disableLogs&&console.log(a.type,"->",ge(a.size)),h){var s;try{s=B.createObjectURL(a)}catch(y){}"function"==typeof h.call?h.call(i,s):h(s)}!e.autoWriteToDisk||T(function(y){var R={};R[e.type+"Blob"]=y,Q.Store(R)})}else"function"==typeof h.call?h.call(i,""):h("")}}function m(h){postMessage((new FileReaderSync).readAsDataURL(h))}function T(h,c){if(!h)throw"Pass a callback function over getDataURL.";var v=c?c.blob:(f||{}).blob;if(!v)return e.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){T(h,c)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var s=new FileReader;s.readAsDataURL(v),s.onload=function(R){h(R.target.result)}}else{var a=function y(R){try{var _=B.createObjectURL(new Blob([R.toString(),"this.onmessage =  function (eee) {"+R.name+"(eee.data);}"],{type:"application/javascript"})),M=new Worker(_);return B.revokeObjectURL(_),M}catch(E){}}(m);a.onmessage=function(R){h(R.data)},a.postMessage(v)}}function p(h){if(h=h||0,"paused"!==i.state){if("stopped"!==i.state){if(h>=i.recordingDuration)return void o(i.onRecordingStopped);h+=1e3,setTimeout(function(){p(h)},1e3)}}else setTimeout(function(){p(h)},1e3)}function w(h){!i||(i.state=h,"function"==typeof i.onStateChanged.call?i.onStateChanged.call(i,h):i.onStateChanged(h))}var b='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function g(){!0!==e.disableLogs&&console.warn(b)}var f,A={startRecording:function d(h){return e.disableLogs||console.log("RecordRTC version: ",i.version),h&&(e=new be(r,h)),e.disableLogs||console.log("started recording "+e.type+" stream."),f?(f.clearRecordedData(),f.record(),w("recording"),i.recordingDuration&&p(),i):(u(function(){i.recordingDuration&&p()}),i)},stopRecording:o,pauseRecording:function l(){f?"recording"===i.state?(w("paused"),f.pause(),e.disableLogs||console.log("Paused recording.")):e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",i.state):g()},resumeRecording:function n(){f?"paused"===i.state?(w("recording"),f.resume(),e.disableLogs||console.log("Resumed recording.")):e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",i.state):g()},initRecorder:u,setRecordingDuration:function(h,c){if(void 0===h)throw"recordingDuration is required.";if("number"!=typeof h)throw"recordingDuration must be a number.";return i.recordingDuration=h,i.onRecordingStopped=c||function(){},{onRecordingStopped:function(v){i.onRecordingStopped=v}}},clearRecordedData:function(){f?(f.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")):g()},getBlob:function(){if(f)return f.blob;g()},getDataURL:T,toURL:function(){if(f)return B.createObjectURL(f.blob);g()},getInternalRecorder:function(){return f},save:function(h){f?Re(f.blob,h):g()},getFromDisk:function(h){f?S.getFromDisk(e.type,h):g()},setAdvertisementArray:function(h){e.advertisement=[];for(var c=h.length,v=0;v<c;v++)e.advertisement.push({duration:v,image:h[v]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"===i.state&&!e.disableLogs&&console.warn("Stop an active recorder."),f&&"function"==typeof f.clearRecordedData&&f.clearRecordedData(),f=null,w("inactive"),i.blob=null},onStateChanged:function(h){e.disableLogs||console.log("Recorder state changed:",h)},state:"inactive",getState:function(){return i.state},destroy:function(){var h=e.disableLogs;e={disableLogs:!0},i.reset(),w("destroyed"),A=i=null,re.AudioContextConstructor&&(re.AudioContextConstructor.close(),re.AudioContextConstructor=null),e.disableLogs=h,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return i=A,A;for(var k in A)this[k]=A[k];return i=this,A}function be(r,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":!!e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===F||e.recorderType===U||void 0!==ve&&e.recorderType===ve?e.type="video":e.recorderType===Se?e.type="gif":e.recorderType===C?e.type="audio":e.recorderType===L&&(D(r,"audio").length&&D(r,"video").length||!D(r,"audio").length&&D(r,"video").length?e.type="video":D(r,"audio").length&&!D(r,"video").length&&(e.type="audio"))),void 0!==L&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0])),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}function t(r,e){var i;return(Y||me||ue)&&(i=C),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!Y&&(i=L),"video"===e.type&&(Y||ue)&&(i=F,void 0!==ve&&"undefined"!=typeof ReadableStream&&(i=ve)),"gif"===e.type&&(i=Se),"canvas"===e.type&&(i=U),x()&&i!==U&&i!==Se&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(D(r,"video").length||D(r,"audio").length)&&("audio"===e.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(i=L):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(i=L)),r instanceof Array&&r.length&&(i=Ie),e.recorderType&&(i=e.recorderType),!e.disableLogs&&!!i&&!!i.name&&console.log("Using recorderType:",i.name||i.constructor.name),!i&&ce&&(i=L),i}function he(r){this.addStream=function(e){e&&(r=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var i,e=this.mediaType,d=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof e.audio&&x()&&!D(r,"audio").length&&(e.audio=!1),"function"!=typeof e.video&&x()&&!D(r,"video").length&&(e.video=!1),"function"!=typeof e.gif&&x()&&!D(r,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(i=null,"function"==typeof e.audio&&(i=e.audio),this.audioRecorder=new S(r,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:i,mimeType:d.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){i=null,"function"==typeof e.video&&(i=e.video);var u=r;if(x()&&e.audio&&"function"==typeof e.audio){var o=D(r,"video")[0];ye?((u=new H).addTrack(o),i&&i===F&&(i=L)):(u=new H).addTrack(o)}this.videoRecorder=new S(u,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:i,mimeType:d.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var l=this,n=!0===x();(e.audio instanceof C&&!!e.video||!0!==e.audio&&!0!==e.video&&e.audio!==e.video)&&(n=!1),!0===n?(l.audioRecorder=null,l.videoRecorder.startRecording()):l.videoRecorder.initRecorder(function(){l.audioRecorder.initRecorder(function(){l.videoRecorder.startRecording(),l.audioRecorder.startRecording()})})}e.gif&&(i=null,"function"==typeof e.gif&&(i=e.gif),this.gifRecorder=new S(r,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:i,mimeType:d.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(i){e(i,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(i){e(i,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(i){e(i,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var i={};return this.audioRecorder&&(i.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(i.video=this.videoRecorder.getBlob()),this.gifRecorder&&(i.gif=this.gifRecorder.getBlob()),e&&e(i),i},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function i(u,o){if("undefined"!=typeof Worker){var l=function d(u){var n,o=B.createObjectURL(new Blob([u.toString(),"this.onmessage =  function (eee) {"+u.name+"(eee.data);}"],{type:"application/javascript"})),l=new Worker(o);if(void 0!==B)n=B;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";n=webkitURL}return n.revokeObjectURL(o),l}(function(T){postMessage((new FileReaderSync).readAsDataURL(T))});l.onmessage=function(m){o(m.data)},l.postMessage(u)}else{var n=new FileReader;n.readAsDataURL(u),n.onload=function(m){o(m.target.result)}}}this.getBlob(function(u){u.audio&&u.video?i(u.audio,function(o){i(u.video,function(l){e({audio:o,video:l})})}):u.audio?i(u.audio,function(o){e({audio:o})}):u.video&&i(u.video,function(o){e({video:o})})})},this.writeToDisk=function(){S.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){!!(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),!!e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}S.version="5.6.2",le.exports=S,void 0!==(V=function(){return S}.apply(pe,[]))&&(le.exports=V),S.getFromDisk=function(r,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+("all"===r?"blobs":r+" blob ")+" from disk!"),Q.Fetch(function(i,d){"all"!==r&&d===r+"Blob"&&e&&e(i),"all"===r&&e&&e(i,d.replace("Blob",""))})},S.writeToDisk=function(r){console.log("Writing recorded blob(s) to disk!"),(r=r||{}).audio&&r.video&&r.gif?r.audio.getDataURL(function(e){r.video.getDataURL(function(i){r.gif.getDataURL(function(d){Q.Store({audioBlob:e,videoBlob:i,gifBlob:d})})})}):r.audio&&r.video?r.audio.getDataURL(function(e){r.video.getDataURL(function(i){Q.Store({audioBlob:e,videoBlob:i})})}):r.audio&&r.gif?r.audio.getDataURL(function(e){r.gif.getDataURL(function(i){Q.Store({audioBlob:e,gifBlob:i})})}):r.video&&r.gif?r.video.getDataURL(function(e){r.gif.getDataURL(function(i){Q.Store({videoBlob:e,gifBlob:i})})}):r.audio?r.audio.getDataURL(function(e){Q.Store({audioBlob:e})}):r.video?r.video.getDataURL(function(e){Q.Store({videoBlob:e})}):r.gif&&r.gif.getDataURL(function(e){Q.Store({gifBlob:e})})},he.getFromDisk=S.getFromDisk,he.writeToDisk=S.writeToDisk,void 0!==S&&(S.MRecordRTC=he),!(r="undefined"!=typeof global?global:null)||"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),(void 0===global.console.log||void 0===global.console.error)&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(r.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},r.HTMLVideoElement=function(){}),"undefined"==typeof location&&(r.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(r.screen={width:0,height:0}),void 0===B&&(r.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),r.window=global);var J=window.requestAnimationFrame;if(void 0===J)if("undefined"!=typeof webkitRequestAnimationFrame)J=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)J=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)J=msRequestAnimationFrame;else if(void 0===J){var we=0;J=function(r,e){var i=(new Date).getTime(),d=Math.max(0,16-(i-we)),u=setTimeout(function(){r(i+d)},d);return we=i+d,u}}var ee=window.cancelAnimationFrame;void 0===ee&&("undefined"!=typeof webkitCancelAnimationFrame?ee=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?ee=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?ee=msCancelAnimationFrame:void 0===ee&&(ee=function(r){clearTimeout(r)}));var ae=window.AudioContext;void 0===ae&&("undefined"!=typeof webkitAudioContext&&(ae=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(ae=mozAudioContext));var B=window.URL;void 0===B&&"undefined"!=typeof webkitURL&&(B=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var me=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),ue=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),ye=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),Y=!ue&&!me&&!!navigator.webkitGetUserMedia||xe()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),ce=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);ce&&!Y&&-1!==navigator.userAgent.indexOf("CriOS")&&(ce=!1,Y=!0);var H=window.MediaStream;function ge(r){if(0===r)return"0 Bytes";var d=parseInt(Math.floor(Math.log(r)/Math.log(1e3)),10);return(r/Math.pow(1e3,d)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][d]}function Re(r,e){if(!r)throw"Blob object is required.";if(!r.type)try{r.type="video/webm"}catch(l){}var i=(r.type||"video/webm").split("/")[1];if(-1!==i.indexOf(";")&&(i=i.split(";")[0]),e&&-1!==e.indexOf(".")){var d=e.split(".");e=d[0],i=d[1]}var u=(e||Math.round(9999999999*Math.random())+888888888)+"."+i;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(r,u);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(r,u);var o=document.createElement("a");o.href=B.createObjectURL(r),o.download=u,o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),"function"==typeof o.click?o.click():(o.target="_blank",o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),B.revokeObjectURL(o.href)}function xe(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||"undefined"!=typeof process&&"object"==typeof process.versions&&!!process.versions.electron||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}function D(r,e){return r&&r.getTracks?r.getTracks().filter(function(i){return i.kind===(e||"audio")}):[]}function Ce(r,e){"srcObject"in e?e.srcObject=r:"mozSrcObject"in e?e.mozSrcObject=r:e.srcObject=r}void 0===H&&"undefined"!=typeof webkitMediaStream&&(H=webkitMediaStream),void 0!==H&&void 0===H.prototype.stop&&(H.prototype.stop=function(){this.getTracks().forEach(function(r){r.stop()})}),void 0!==S&&(S.invokeSaveAsDialog=Re,S.getTracks=D,S.getSeekableBlob=function _e(r,e){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var i=new EBML.Reader,d=new EBML.Decoder,u=EBML.tools,o=new FileReader;o.onload=function(l){d.decode(this.result).forEach(function(w){i.read(w)}),i.stop();var m=u.makeMetadataSeekable(i.metadatas,i.duration,i.cues),T=this.result.slice(i.metadataSize),p=new Blob([m,T],{type:"video/webm"});e(p)},o.readAsArrayBuffer(r)},S.bytesToSize=ge,S.isElectron=xe);var re={};function x(){if(ye||ce||me)return!0;navigator;var o,l,e=navigator.userAgent,i=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10);return(Y||ue)&&(o=e.indexOf("Chrome"),i=e.substring(o+7)),-1!==(l=i.indexOf(";"))&&(i=i.substring(0,l)),-1!==(l=i.indexOf(" "))&&(i=i.substring(0,l)),d=parseInt(""+i,10),isNaN(d)&&(i=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10)),d>=49}function L(r,e){var i,p=this;if(void 0===r)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(e=e||{mimeType:"video/webm"}).type&&(D(r,"video").length&&D(r,"audio").length&&(navigator.mozGetUserMedia?(i=new H).addTrack(D(r,"audio")[0]):i=new H(D(r,"audio")),r=i),(!e.mimeType||-1===e.mimeType.toString().toLowerCase().indexOf("audio"))&&(e.mimeType=Y?"audio/webm":"audio/ogg"),e.mimeType&&"audio/ogg"!==e.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg"));var n,d=[];function u(){p.timestamps.push((new Date).getTime()),"function"==typeof e.onTimeStamp&&e.onTimeStamp(p.timestamps[p.timestamps.length-1],p.timestamps)}function o(w){return n&&n.mimeType?n.mimeType:w.mimeType||"video/webm"}function l(){d=[],n=null,p.timestamps=[]}this.getArrayOfBlobs=function(){return d},this.record=function(){p.blob=null,p.clearRecordedData(),p.timestamps=[],T=[],d=[];var w=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",w),n&&(n=null),Y&&!x()&&(w="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&w.mimeType&&(MediaRecorder.isTypeSupported(w.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType),w.mimeType="audio"===e.type?"audio/webm":"video/webm"));try{n=new MediaRecorder(r,w),e.mimeType=w.mimeType}catch(b){n=new MediaRecorder(r)}w.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in n&&!1===n.canRecordMimeType(w.mimeType)&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType)),n.ondataavailable=function(b){if(b.data&&T.push("ondataavailable: "+ge(b.data.size)),"number"!=typeof e.timeSlice)!b.data||!b.data.size||b.data.size<100||p.blob?p.recordingCallback&&(p.recordingCallback(new Blob([],{type:o(w)})),p.recordingCallback=null):(p.blob=e.getNativeBlob?b.data:new Blob([b.data],{type:o(w)}),p.recordingCallback&&(p.recordingCallback(p.blob),p.recordingCallback=null));else if(b.data&&b.data.size&&(d.push(b.data),u(),"function"==typeof e.ondataavailable)){var g=e.getNativeBlob?b.data:new Blob([b.data],{type:o(w)});e.ondataavailable(g)}},n.onstart=function(){T.push("started")},n.onpause=function(){T.push("paused")},n.onresume=function(){T.push("resumed")},n.onstop=function(){T.push("stopped")},n.onerror=function(b){!b||(b.name||(b.name="UnknownError"),T.push("error: "+b),e.disableLogs||(-1!==b.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",b):-1!==b.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",w.mimeType,") is not supported.",b):-1!==b.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",b):"OutOfMemory"===b.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"IllegalStreamModification"===b.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"OtherRecordingError"===b.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",b):"GenericError"===b.name?console.error("The UA cannot provide the codec or recording option that has been requested.",b):console.error("MediaRecorder Error",b)),function(g){if(!p.manuallyStopped&&n&&"inactive"===n.state)return delete e.timeslice,void n.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==n.state&&"stopped"!==n.state&&n.stop())},"number"==typeof e.timeSlice?(u(),n.start(e.timeSlice)):n.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[],this.stop=function(w){w=w||function(){},p.manuallyStopped=!0,n&&(this.recordingCallback=w,"recording"===n.state&&n.stop(),"number"==typeof e.timeSlice&&setTimeout(function(){p.blob=new Blob(d,{type:o(e)}),p.recordingCallback(p.blob)},100))},this.pause=function(){!n||"recording"===n.state&&n.pause()},this.resume=function(){!n||"paused"===n.state&&n.resume()},this.clearRecordedData=function(){n&&"recording"===n.state&&p.stop(l),l()},this.getInternalRecorder=function(){return n},this.blob=null,this.getState=function(){return n&&n.state||"inactive"};var T=[];this.getAllStates=function(){return T},void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!1),p=this,function w(){if(n&&!1!==e.checkForInactiveTracks){if(!1===function m(){if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}())return e.disableLogs||console.log("MediaStream seems stopped."),void p.stop();setTimeout(w,1e3)}}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function C(r,e){if(!D(r,"audio").length)throw"Your stream has no audio tracks.";var n,i=this,d=[],u=[],o=!1,l=0,m=2,T=(e=e||{}).desiredSampRate;function p(){if(!1===e.checkForInactiveTracks)return!0;if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}function w(M,E){function O(P,fe){var ke,K=P.numberOfAudioChannels,q=P.leftBuffers.slice(0),oe=P.rightBuffers.slice(0),X=P.sampleRate,te=P.internalInterleavedLength,z=P.desiredSampRate;function de(I,$,W){var G=Math.round(I.length*($/W)),N=[],ie=Number((I.length-1)/(G-1));N[0]=I[0];for(var se=1;se<G-1;se++){var Pe=se*ie,Ze=Number(Math.floor(Pe)).toFixed(),We=Number(Math.ceil(Pe)).toFixed();N[se]=De(I[Ze],I[We],Pe-Ze)}return N[G-1]=I[I.length-1],N}function De(I,$,W){return I+($-I)*W}function Be(I,$){for(var W=new Float64Array($),G=0,N=I.length,ie=0;ie<N;ie++){var se=I[ie];W.set(se,G),G+=se.length}return W}function Ae(I,$,W){for(var G=W.length,N=0;N<G;N++)I.setUint8($+N,W.charCodeAt(N))}2===K&&(q=Be(q,te),oe=Be(oe,te),z&&(q=de(q,z,X),oe=de(oe,z,X))),1===K&&(q=Be(q,te),z&&(q=de(q,z,X))),z&&(X=z),2===K&&(ke=function Ne(I,$){for(var W=I.length+$.length,G=new Float64Array(W),N=0,ie=0;ie<W;)G[ie++]=I[N],G[ie++]=$[N],N++;return G}(q,oe)),1===K&&(ke=q);var Me=ke.length,Fe=new ArrayBuffer(44+2*Me),Z=new DataView(Fe);Ae(Z,0,"RIFF"),Z.setUint32(4,36+2*Me,!0),Ae(Z,8,"WAVE"),Ae(Z,12,"fmt "),Z.setUint32(16,16,!0),Z.setUint16(20,1,!0),Z.setUint16(22,K,!0),Z.setUint32(24,X,!0),Z.setUint32(28,X*K*2,!0),Z.setUint16(32,2*K,!0),Z.setUint16(34,16,!0),Ae(Z,36,"data"),Z.setUint32(40,2*Me,!0);for(var ze=Me,Ee=44,Oe=0;Oe<ze;Oe++)Z.setInt16(Ee,32767*ke[Oe],!0),Ee+=2;if(fe)return fe({buffer:Fe,view:Z});postMessage({buffer:Fe,view:Z})}if(M.noWorker)O(M,function(P){E(P.buffer,P.view)});else{var ne=function b(M){var E=B.createObjectURL(new Blob([M.toString(),";this.onmessage =  function (eee) {"+M.name+"(eee.data);}"],{type:"application/javascript"})),O=new Worker(E);return O.workerURL=E,O}(O);ne.onmessage=function(P){E(P.data.buffer,P.data.view),B.revokeObjectURL(ne.workerURL),ne.terminate()},ne.postMessage(M)}}!0===e.leftChannel&&(m=1),1===e.numberOfAudioChannels&&(m=1),(!m||m<1)&&(m=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+m),void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!0),this.record=function(){if(!1===p())throw"Please make sure MediaStream is active.";v(),s=c=!1,o=!0,void 0!==e.timeSlice&&_()},this.stop=function(M){M=M||function(){},o=!1,w({desiredSampRate:T,sampleRate:h,numberOfAudioChannels:m,internalInterleavedLength:l,leftBuffers:d,rightBuffers:1===m?[]:u,noWorker:e.noWorker},function(E,O){i.blob=new Blob([O],{type:"audio/wav"}),i.buffer=new ArrayBuffer(O.buffer.byteLength),i.view=O,i.sampleRate=T||h,i.bufferSize=k,i.length=l,s=!1,M&&M(i.blob)})},void 0===S.Storage&&(S.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!S.Storage.AudioContextConstructor||"closed"===S.Storage.AudioContextConstructor.state)&&(S.Storage.AudioContextConstructor=new S.Storage.AudioContext);var g=S.Storage.AudioContextConstructor,f=g.createMediaStreamSource(r),A=[0,256,512,1024,2048,4096,8192,16384],k=void 0===e.bufferSize?4096:e.bufferSize;if(-1===A.indexOf(k)&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(A,null,"\t"))),g.createJavaScriptNode)n=g.createJavaScriptNode(k,m,m);else{if(!g.createScriptProcessor)throw"WebAudio API has no support on this browser.";n=g.createScriptProcessor(k,m,m)}f.connect(n),e.bufferSize||(k=n.bufferSize);var h=void 0!==e.sampleRate?e.sampleRate:g.sampleRate||44100;(h<22050||h>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var c=!1;function v(){u=[],l=0,s=!1,o=!1,c=!1,g=null,i.leftchannel=d=[],i.rightchannel=u,i.numberOfAudioChannels=m,i.desiredSampRate=T,i.sampleRate=h,i.recordingLength=l,R={left:[],right:[],recordingLength:0}}function a(){n&&(n.onaudioprocess=null,n.disconnect(),n=null),f&&(f.disconnect(),f=null),v()}this.pause=function(){c=!0},this.resume=function(){if(!1===p())throw"Please make sure MediaStream is active.";if(!o)return e.disableLogs||console.log("Seems recording has been restarted."),void this.record();c=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,o&&this.stop(a),a()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var s=!1;n.onaudioprocess=function y(M){if(!c){if(!1===p()&&(e.disableLogs||console.log("MediaStream seems stopped."),n.disconnect(),o=!1),!o)return void(f&&(f.disconnect(),f=null));s||(s=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var E=M.inputBuffer.getChannelData(0),O=new Float32Array(E);if(d.push(O),2===m){var ne=M.inputBuffer.getChannelData(1),P=new Float32Array(ne);u.push(P)}i.recordingLength=l+=k,void 0!==e.timeSlice&&(R.recordingLength+=k,R.left.push(O),2===m&&R.right.push(P))}},n.connect(g.createMediaStreamDestination?g.createMediaStreamDestination():g.destination),this.leftchannel=d,this.rightchannel=u,this.numberOfAudioChannels=m,this.desiredSampRate=T,this.sampleRate=h,i.recordingLength=l;var R={left:[],right:[],recordingLength:0};function _(){!o||"function"!=typeof e.ondataavailable||void 0===e.timeSlice||(R.left.length?(w({desiredSampRate:T,sampleRate:h,numberOfAudioChannels:m,internalInterleavedLength:R.recordingLength,leftBuffers:R.left,rightBuffers:1===m?[]:R.right},function(M,E){var O=new Blob([E],{type:"audio/wav"});e.ondataavailable(O),setTimeout(_,e.timeSlice)}),R={left:[],right:[],recordingLength:0}):setTimeout(_,e.timeSlice))}}function U(r,e){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(e=e||{}).frameInterval||(e.frameInterval=10);var i=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(A){A in document.createElement("canvas")&&(i=!0)});var l,n,m,d=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),u=50,o=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(d&&o&&o[2]&&(u=parseInt(o[2],10)),d&&u<52&&(i=!1),e.useWhammyRecorder&&(i=!1),i)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),r instanceof HTMLCanvasElement)l=r;else{if(!(r instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";l=r.canvas}else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(m=!0,i&&!e.useWhammyRecorder){var A;"captureStream"in l?A=l.captureStream(25):"mozCaptureStream"in l?A=l.mozCaptureStream(25):"webkitCaptureStream"in l&&(A=l.webkitCaptureStream(25));try{var k=new H;k.addTrack(D(A,"video")[0]),A=k}catch(h){}if(!A)throw"captureStream API are NOT available.";(n=new L(A,{mimeType:e.mimeType||"video/webm"})).record()}else f.frames=[],g=(new Date).getTime(),b();e.initCallback&&e.initCallback()},this.getWebPImages=function(A){if("canvas"===r.nodeName.toLowerCase()){var k=f.frames.length;f.frames.forEach(function(h,c){var v=k-c;e.disableLogs||console.log(v+"/"+k+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(v,k);var a=h.image.toDataURL("image/webp",1);f.frames[c].image=a}),e.disableLogs||console.log("Generating WebM"),A()}else A()},this.stop=function(A){m=!1;var k=this;i&&n?n.stop(A):this.getWebPImages(function(){f.compile(function(h){e.disableLogs||console.log("Recording finished!"),k.blob=h,k.blob.forEach&&(k.blob=new Blob([],{type:"video/webm"})),A&&A(k.blob),f.frames=[]})})};var T=!1;function p(){f.frames=[],m=!1,T=!1}function w(){var A=document.createElement("canvas"),k=A.getContext("2d");return A.width=r.width,A.height=r.height,k.drawImage(r,0,0),A}function b(){if(T)return g=(new Date).getTime(),setTimeout(b,500);if("canvas"===r.nodeName.toLowerCase()){var A=(new Date).getTime()-g;return g=(new Date).getTime(),f.frames.push({image:w(),duration:A}),void(m&&setTimeout(b,e.frameInterval))}html2canvas(r,{grabMouse:void 0===e.showMousePointer||e.showMousePointer,onrendered:function(k){var h=(new Date).getTime()-g;if(!h)return setTimeout(b,e.frameInterval);g=(new Date).getTime(),f.frames.push({image:k.toDataURL("image/webp",1),duration:h}),m&&setTimeout(b,e.frameInterval)}})}this.pause=function(){T=!0,n instanceof L&&n.pause()},this.resume=function(){T=!1,n instanceof L?n.resume():m||this.record()},this.clearRecordedData=function(){m&&this.stop(p),p()},this.name="CanvasRecorder",this.toString=function(){return this.name};var g=(new Date).getTime(),f=new Te.Video(100)}function F(r,e){function i(g){g=void 0!==g?g:10;var f=(new Date).getTime()-w;return f?l?(w=(new Date).getTime(),setTimeout(i,100)):(w=(new Date).getTime(),p.paused&&p.play(),T.drawImage(p,0,0,m.width,m.height),b.frames.push({duration:f,image:m.toDataURL("image/webp")}),void(o||setTimeout(i,g,g))):setTimeout(i,g,g)}(e=e||{}).frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),m.width=e.canvas.width||320,m.height=e.canvas.height||240,T=m.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(p=e.video.cloneNode(),e.initCallback&&e.initCallback()):(p=document.createElement("video"),Ce(r,p),p.onloadedmetadata=function(){e.initCallback&&e.initCallback()},p.width=e.video.width,p.height=e.video.height),p.muted=!0,p.play(),w=(new Date).getTime(),b=new Te.Video,e.disableLogs||(console.log("canvas resolutions",m.width,"*",m.height),console.log("video width/height",p.width||m.width,"*",p.height||m.height)),i(e.frameInterval)};var o=!1;this.stop=function(g){g=g||function(){},o=!0;var f=this;setTimeout(function(){!function u(g,f,A,k,h){var c=document.createElement("canvas");c.width=m.width,c.height=m.height;var v=c.getContext("2d"),a=[],s=-1===f,y=f&&f>0&&f<=g.length?f:g.length,_=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),M=A&&A>=0&&A<=1?A:0,E=k&&k>=0&&k<=1?k:0,O=!1;!function d(g){var f=-1,A=g.length;!function k(){++f!==A?setTimeout(function(){g.functionToLoop(k,f)},1):g.callback()}()}({length:y,functionToLoop:function(ne,P){var fe,K,q,oe=function(){!O&&q-fe<=q*E||(s&&(O=!0),a.push(g[P])),ne()};if(O)oe();else{var X=new Image;X.onload=function(){v.drawImage(X,0,0,m.width,m.height);var te=v.getImageData(0,0,m.width,m.height);fe=0,K=te.data.length,q=te.data.length/4;for(var z=0;z<K;z+=4){var de={r:te.data[z],g:te.data[z+1],b:te.data[z+2]};Math.sqrt(Math.pow(de.r-0,2)+Math.pow(de.g-0,2)+Math.pow(de.b-0,2))<=_*M&&fe++}oe()},X.src=g[P].image}},callback:function(){(a=a.concat(g.slice(y))).length<=0&&a.push(g[g.length-1]),h(a)}})}(b.frames,-1,null,null,function(A){b.frames=A,e.advertisement&&e.advertisement.length&&(b.frames=e.advertisement.concat(b.frames)),b.compile(function(k){f.blob=k,f.blob.forEach&&(f.blob=new Blob([],{type:"video/webm"})),g&&g(f.blob)})})},10)};var l=!1;function n(){b.frames=[],o=!0,l=!1}this.pause=function(){l=!0},this.resume=function(){l=!1,o&&this.record()},this.clearRecordedData=function(){o||this.stop(n),n()},this.name="WhammyRecorder",this.toString=function(){return this.name};var p,w,b,m=document.createElement("canvas"),T=m.getContext("2d")}void 0!==ae?re.AudioContext=ae:"undefined"!=typeof webkitAudioContext&&(re.AudioContext=webkitAudioContext),void 0!==S&&(S.Storage=re),void 0!==S&&(S.MediaStreamRecorder=L),void 0!==S&&(S.StereoAudioRecorder=C),void 0!==S&&(S.CanvasRecorder=U),void 0!==S&&(S.WhammyRecorder=F);var Te=function(){function r(d){this.frames=[],this.duration=d||1,this.quality=.8}function i(d){function o(c,v,a){return[{data:c,id:231}].concat(a.map(function(s){var y=function b(c){var v=0;if(c.keyframe&&(v|=128),c.invisible&&(v|=8),c.lacing&&(v|=c.lacing<<1),c.discardable&&(v|=1),c.trackNum>127)throw"TrackNumber > 127 not supported";var a=[128|c.trackNum,c.timecode>>8,255&c.timecode,v].map(function(s){return String.fromCharCode(s)}).join("")+c.frame;return a}({discardable:0,frame:s.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(v)});return v+=s.duration,{data:y,id:163}}))}function n(c){for(var v=[];c>0;)v.push(255&c),c>>=8;return new Uint8Array(v.reverse())}function m(c){return new Uint8Array(c.split("").map(function(v){return v.charCodeAt(0)}))}function T(c){var v=[];c=(c.length%8?new Array(9-c.length%8).join("0"):"")+c;for(var s=0;s<c.length;s+=8)v.push(parseInt(c.substr(s,8),2));return new Uint8Array(v)}function p(c){for(var v=[],a=0;a<c.length;a++){var s=c[a].data;"object"==typeof s&&(s=p(s)),"number"==typeof s&&(s=T(s.toString(2))),"string"==typeof s&&(s=m(s));var y=s.size||s.byteLength||s.length,R=Math.ceil(Math.ceil(Math.log(y)/Math.log(2))/8),_=y.toString(2),M=new Array(7*R+7+1-_.length).join("0")+_,E=new Array(R).join("0")+"1"+M;v.push(n(c[a].id)),v.push(T(E)),v.push(s)}return new Blob(v,{type:"video/webm"})}function f(c,v){return parseInt(c.substr(v+4,4).split("").map(function(a){var s=a.charCodeAt(0).toString(2);return new Array(8-s.length+1).join("0")+s}).join(""),2)}function A(c){for(var v=0,a={};v<c.length;){var s=c.substr(v,4),y=f(c,v),R=c.substr(v+4+4,y);v+=8+y,a[s]=a[s]||[],a[s].push("RIFF"===s||"LIST"===s?A(R):R)}return a}function k(c){return[].slice.call(new Uint8Array(new Float64Array([c]).buffer),0).map(function(v){return String.fromCharCode(v)}).reverse().join("")}var h=new function u(c){var v=function l(c){if(c[0]){for(var v=c[0].width,a=c[0].height,s=c[0].duration,y=1;y<c.length;y++)s+=c[y].duration;return{duration:s,width:v,height:a}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(c);if(!v)return[];for(var s=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:k(v.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:v.width,id:176},{data:v.height,id:186}]}]}]}]}],y=0,R=0;y<c.length;){var _=[],M=0;do{_.push(c[y]),M+=c[y].duration,y++}while(y<c.length&&M<3e4);var O={id:524531317,data:o(R,0,_)};s[1].data.push(O),R+=M}return p(s)}(d.map(function(c){var v=function g(c){for(var v=c.RIFF[0].WEBP[0],a=v.indexOf("\x9d\x01*"),s=0,y=[];s<4;s++)y[s]=v.charCodeAt(a+3+s);return{width:16383&(y[1]<<8|y[0]),height:16383&(y[3]<<8|y[2]),data:v,riff:c}}(A(atob(c.image.slice(23))));return v.duration=c.duration,v}));postMessage(h)}return r.prototype.add=function(d,u){if("canvas"in d&&(d=d.canvas),"toDataURL"in d&&(d=d.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(d))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:d,duration:u||this.duration})},r.prototype.compile=function(d){var u=function e(d){var u=B.createObjectURL(new Blob([d.toString(),"this.onmessage =  function (eee) {"+d.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(u);return B.revokeObjectURL(u),o}(i);u.onmessage=function(o){o.data.error?console.error(o.data.error):d(o.data)},u.postMessage(this.frames)},{Video:r}}();void 0!==S&&(S.Whammy=Te);var Q={init:function(){var r=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var d,i=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),u=indexedDB.open(i,1);u.onerror=r.onError,u.onsuccess=function(){(d=u.result).onerror=r.onError,d.setVersion&&1!==d.version?d.setVersion(1).onsuccess=function(){o(d),l()}:l()},u.onupgradeneeded=function(n){o(n.target.result)}}else console.error("IndexedDB API are not available in this browser.");function o(n){n.createObjectStore(r.dataStoreName)}function l(){var n=d.transaction([r.dataStoreName],"readwrite");function m(T){n.objectStore(r.dataStoreName).get(T).onsuccess=function(p){r.callback&&r.callback(p.target.result,T)}}r.videoBlob&&n.objectStore(r.dataStoreName).put(r.videoBlob,"videoBlob"),r.gifBlob&&n.objectStore(r.dataStoreName).put(r.gifBlob,"gifBlob"),r.audioBlob&&n.objectStore(r.dataStoreName).put(r.audioBlob,"audioBlob"),m("audioBlob"),m("videoBlob"),m("gifBlob")}},Fetch:function(r){return this.callback=r,this.init(),this},Store:function(r){return this.audioBlob=r.audioBlob,this.videoBlob=r.videoBlob,this.gifBlob=r.gifBlob,this.init(),this},onError:function(r){console.error(JSON.stringify(r,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function Se(r,e){if("undefined"==typeof GIFEncoder){var i=document.createElement("script");i.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(i)}e=e||{};var d=r instanceof CanvasRenderingContext2D||r instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&m?(d||(e.width||(e.width=T.offsetWidth||320),e.height||(e.height=T.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),l.width=e.canvas.width||320,l.height=e.canvas.height||240,T.width=e.video.width||320,T.height=e.video.height||240),(f=new GIFEncoder).setRepeat(0),f.setDelay(e.frameRate||200),f.setQuality(e.quality||10),f.start(),"function"==typeof e.onGifRecordingStarted&&e.onGifRecordingStarted(),Date.now(),p=J(function k(h){if(!0!==A.clearedRecordedData){if(u)return setTimeout(function(){k(h)},100);p=J(k),void 0===typeof g&&(g=h),!(h-g<90)&&(!d&&T.paused&&T.play(),d||n.drawImage(T,0,0,l.width,l.height),e.onGifPreview&&e.onGifPreview(l.toDataURL("image/png")),f.addFrame(n),g=h)}}),e.initCallback&&e.initCallback()):setTimeout(A.record,1e3)},this.stop=function(k){k=k||function(){},p&&ee(p),Date.now(),this.blob=new Blob([new Uint8Array(f.stream().bin)],{type:"image/gif"}),k(this.blob),f.stream().bin=[]};var u=!1;this.pause=function(){u=!0},this.resume=function(){u=!1},this.clearRecordedData=function(){A.clearedRecordedData=!0,function o(){f&&(f.stream().bin=[])}()},this.name="GifRecorder",this.toString=function(){return this.name};var l=document.createElement("canvas"),n=l.getContext("2d");d&&(r instanceof CanvasRenderingContext2D?l=(n=r).canvas:r instanceof HTMLCanvasElement&&(n=r.getContext("2d"),l=r));var m=!0;if(!d){var T=document.createElement("video");T.muted=!0,T.autoplay=!0,T.playsInline=!0,m=!1,T.onloadedmetadata=function(){m=!0},Ce(r,T),T.play()}var g,f,p=null,A=this}function Ue(r,e){var a;a="undefined"!=typeof global?global:null,void 0===S&&(!a||"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),(void 0===global.console.log||void 0===global.console.error)&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(a.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var s={getContext:function(){return s},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return s},a.HTMLVideoElement=function(){}),"undefined"==typeof location&&(a.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(a.screen={width:0,height:0}),void 0===T&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=global)),e=e||"multi-streams-mixer";var d=[],u=!1,o=document.createElement("canvas"),l=o.getContext("2d");o.style.opacity=0,o.style.position="absolute",o.style.zIndex=-1,o.style.top="-1000em",o.style.left="-1000em",o.className=e,(document.body||document.documentElement).appendChild(o),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var n=this,m=window.AudioContext;void 0===m&&("undefined"!=typeof webkitAudioContext&&(m=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(m=mozAudioContext));var T=window.URL;void 0===T&&"undefined"!=typeof webkitURL&&(T=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var p=window.MediaStream;void 0===p&&"undefined"!=typeof webkitMediaStream&&(p=webkitMediaStream),void 0!==p&&void 0===p.prototype.stop&&(p.prototype.stop=function(){this.getTracks().forEach(function(a){a.stop()})});var w={};function g(){if(!u){var a=d.length,s=!1,y=[];if(d.forEach(function(_){_.stream||(_.stream={}),_.stream.fullcanvas?s=_:y.push(_)}),s)o.width=s.stream.width,o.height=s.stream.height;else if(y.length){o.width=a>1?2*y[0].width:y[0].width;var R=1;(3===a||4===a)&&(R=2),(5===a||6===a)&&(R=3),(7===a||8===a)&&(R=4),(9===a||10===a)&&(R=5),o.height=y[0].height*R}else o.width=n.width||360,o.height=n.height||240;s&&s instanceof HTMLVideoElement&&f(s),y.forEach(function(_,M){f(_,M)}),setTimeout(g,n.frameInterval)}}function f(a,s){if(!u){var y=0,R=0,_=a.width,M=a.height;1===s&&(y=a.width),2===s&&(R=a.height),3===s&&(y=a.width,R=a.height),4===s&&(R=2*a.height),5===s&&(y=a.width,R=2*a.height),6===s&&(R=3*a.height),7===s&&(y=a.width,R=3*a.height),void 0!==a.stream.left&&(y=a.stream.left),void 0!==a.stream.top&&(R=a.stream.top),void 0!==a.stream.width&&(_=a.stream.width),void 0!==a.stream.height&&(M=a.stream.height),l.drawImage(a,y,R,_,M),"function"==typeof a.stream.onRender&&a.stream.onRender(l,y,R,_,M,s)}}function c(a){var s=document.createElement("video");return function b(a,s){"srcObject"in s?s.srcObject=a:"mozSrcObject"in s?s.mozSrcObject=a:s.srcObject=a}(a,s),s.className=e,s.muted=!0,s.volume=0,s.width=a.width||n.width||360,s.height=a.height||n.height||240,s.play(),s}function v(a){d=[],(a=a||r).forEach(function(s){if(s.getTracks().filter(function(R){return"video"===R.kind}).length){var y=c(s);y.stream=s,d.push(y)}})}void 0!==m?w.AudioContext=m:"undefined"!=typeof webkitAudioContext&&(w.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){g()},this.appendStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]),a.forEach(function(s){var y=new p;if(s.getTracks().filter(function(M){return"video"===M.kind}).length){var R=c(s);R.stream=s,d.push(R),y.addTrack(s.getTracks().filter(function(M){return"video"===M.kind})[0])}if(s.getTracks().filter(function(M){return"audio"===M.kind}).length){var _=n.audioContext.createMediaStreamSource(s);n.audioDestination=n.audioContext.createMediaStreamDestination(),_.connect(n.audioDestination),y.addTrack(n.audioDestination.stream.getTracks().filter(function(M){return"audio"===M.kind})[0])}r.push(y)})},this.releaseStreams=function(){d=[],u=!0,n.gainNode&&(n.gainNode.disconnect(),n.gainNode=null),n.audioSources.length&&(n.audioSources.forEach(function(a){a.disconnect()}),n.audioSources=[]),n.audioDestination&&(n.audioDestination.disconnect(),n.audioDestination=null),n.audioContext&&n.audioContext.close(),n.audioContext=null,l.clearRect(0,0,o.width,o.height),o.stream&&(o.stream.stop(),o.stream=null)},this.resetVideoStreams=function(a){a&&!(a instanceof Array)&&(a=[a]),v(a)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function A(){u=!1;var a=function k(){var a;v(),"captureStream"in o?a=o.captureStream():"mozCaptureStream"in o?a=o.mozCaptureStream():n.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var s=new p;return a.getTracks().filter(function(y){return"video"===y.kind}).forEach(function(y){s.addTrack(y)}),o.stream=s,s}(),s=function h(){w.AudioContextConstructor||(w.AudioContextConstructor=new w.AudioContext),n.audioContext=w.AudioContextConstructor,n.audioSources=[],!0===n.useGainNode&&(n.gainNode=n.audioContext.createGain(),n.gainNode.connect(n.audioContext.destination),n.gainNode.gain.value=0);var a=0;if(r.forEach(function(s){if(s.getTracks().filter(function(R){return"audio"===R.kind}).length){a++;var y=n.audioContext.createMediaStreamSource(s);!0===n.useGainNode&&y.connect(n.gainNode),n.audioSources.push(y)}}),a)return n.audioDestination=n.audioContext.createMediaStreamDestination(),n.audioSources.forEach(function(s){s.connect(n.audioDestination)}),n.audioDestination.stream}();return s&&s.getTracks().filter(function(R){return"audio"===R.kind}).forEach(function(R){a.addTrack(R)}),r.forEach(function(R){}),a}}function Ie(r,e){r=r||[];var d,u,i=this;(e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){d=new Ue(r,e.elementClass||"multi-streams-mixer"),function o(){var l=[];return r.forEach(function(n){D(n,"video").forEach(function(m){l.push(m)})}),l}().length&&(d.frameInterval=e.frameInterval||10,d.width=e.video.width||360,d.height=e.video.height||240,d.startDrawingFrames()),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(d.getMixedStream()),(u=new L(d.getMixedStream(),e)).record()},this.stop=function(l){!u||u.stop(function(n){i.blob=n,l(n),i.clearRecordedData()})},this.pause=function(){u&&u.pause()},this.resume=function(){u&&u.resume()},this.clearRecordedData=function(){u&&(u.clearRecordedData(),u=null),d&&(d.releaseStreams(),d=null)},this.addStreams=function(l){if(!l)throw"First parameter is required.";l instanceof Array||(l=[l]),r.concat(l),u&&d&&(d.appendStreams(l),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(d.getMixedStream()))},this.resetVideoStreams=function(l){!d||(l&&!(l instanceof Array)&&(l=[l]),d.resetVideoStreams(l))},this.getMixer=function(){return d},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function ve(r,e){var d,o,n;function l(p,w){if(!e.workerPath&&!w)return d=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(g){g.arrayBuffer().then(function(f){l(p,f)})});if(!e.workerPath&&w instanceof ArrayBuffer){var b=new Blob([w],{type:"text/javascript"});e.workerPath=B.createObjectURL(b)}e.workerPath||console.error("workerPath parameter is missing."),(o=new Worker(e.workerPath)).postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),o.addEventListener("message",function(g){"READY"===g.data?(o.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),function u(){return new ReadableStream({start:function(p){var w=document.createElement("canvas"),b=document.createElement("video"),g=!0;b.srcObject=r,b.muted=!0,b.height=e.height,b.width=e.width,b.volume=0,b.onplaying=function(){w.width=e.width,w.height=e.height;var f=w.getContext("2d"),k=setInterval(function(){if(d&&(clearInterval(k),p.close()),g&&(g=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),f.drawImage(b,0,0),"closed"!==p._controlledReadableStream.state)try{p.enqueue(f.getImageData(0,0,e.width,e.height))}catch(c){}},1e3/e.frameRate)},b.play()}})}().pipeTo(new WritableStream({write:function(f){d?console.error("Got image, but recorder is finished!"):o.postMessage(f.data.buffer,[f.data.buffer])}}))):g.data&&(n||T.push(g.data))})}("undefined"==typeof ReadableStream||"undefined"==typeof WritableStream)&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(e=e||{}).width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0,this.record=function(){T=[],n=!1,this.blob=null,l(r),"function"==typeof e.initCallback&&e.initCallback()},this.pause=function(){n=!0},this.resume=function(){n=!1};var T=[];this.stop=function(p){d=!0;var w=this;!function m(p){o?(o.addEventListener("message",function(w){null===w.data&&(o.terminate(),o=null,p&&p())}),o.postMessage(null)):p&&p()}(function(){w.blob=new Blob(T,{type:"video/webm"}),p(w.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){T=[],n=!1,this.blob=null},this.blob=null}void 0!==S&&(S.DiskStorage=Q),void 0!==S&&(S.GifRecorder=Se),void 0===S&&(le.exports=Ue,void 0!==(V=function(){return Ue}.apply(pe,[]))&&(le.exports=V)),void 0!==S&&(S.MultiStreamRecorder=Ie),void 0!==S&&(S.RecordRTCPromisesHandler=function je(r,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===r)throw'First argument "MediaStream" is required.';var i=this;i.recordRTC=new S(r,e),this.startRecording=function(){return new Promise(function(d,u){try{i.recordRTC.startRecording(),d()}catch(o){u(o)}})},this.stopRecording=function(){return new Promise(function(d,u){try{i.recordRTC.stopRecording(function(o){i.blob=i.recordRTC.getBlob(),i.blob&&i.blob.size?d(o):u("Empty blob.",i.blob)})}catch(o){u(o)}})},this.pauseRecording=function(){return new Promise(function(d,u){try{i.recordRTC.pauseRecording(),d()}catch(o){u(o)}})},this.resumeRecording=function(){return new Promise(function(d,u){try{i.recordRTC.resumeRecording(),d()}catch(o){u(o)}})},this.getDataURL=function(d){return new Promise(function(u,o){try{i.recordRTC.getDataURL(function(l){u(l)})}catch(l){o(l)}})},this.getBlob=function(){return new Promise(function(d,u){try{d(i.recordRTC.getBlob())}catch(o){u(o)}})},this.getInternalRecorder=function(){return new Promise(function(d,u){try{d(i.recordRTC.getInternalRecorder())}catch(o){u(o)}})},this.reset=function(){return new Promise(function(d,u){try{d(i.recordRTC.reset())}catch(o){u(o)}})},this.destroy=function(){return new Promise(function(d,u){try{d(i.recordRTC.destroy())}catch(o){u(o)}})},this.getState=function(){return new Promise(function(d,u){try{d(i.recordRTC.getState())}catch(o){u(o)}})},this.blob=null,this.version="5.6.2"}),void 0!==S&&(S.WebAssemblyRecorder=ve)}}]);